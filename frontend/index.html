<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FinNLP - NSE Sentiment Analyzer</title>

<style>
* {
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, sans-serif;
}

body {
    margin: 0;
    height: 100vh;
    background: linear-gradient(135deg, #1f2937, #0f172a);
    display: flex;
    justify-content: center;
    align-items: center;
    color: #fff;
}

.container {
    width: 500px;
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(12px);
    border-radius: 16px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.4);
}

h2 {
    text-align: center;
    margin-bottom: 20px;
}

input, select {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 8px;
    border: none;
    outline: none;
    font-size: 15px;
}

button {
    width: 100%;
    margin-top: 15px;
    padding: 12px;
    border-radius: 8px;
    border: none;
    background: #22c55e;
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
}

button:hover {
    background: #16a34a;
}

#result {
    margin-top: 20px;
    padding: 15px;
    border-radius: 10px;
    background: rgba(0,0,0,0.3);
    min-height: 60px;
}

.loader {
    border: 4px solid rgba(255,255,255,0.2);
    border-top: 4px solid #22c55e;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 10px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.footer {
    text-align: center;
    margin-top: 15px;
    font-size: 12px;
    opacity: 0.7;
}
</style>
</head>

<body>

<div class="container">

    <h2>FinNLP Sentiment Analysis</h2>

    <input type="text" id="searchBox" placeholder="Search company or symbol...">

    <select id="companyDropdown">
        <option>Loading companies...</option>
    </select>

    <button onclick="analyze()">Analyze Sentiment</button>

    <div id="result"></div>

    <div class="footer">
        NSE News + Sector News + FinBERT Analysis
    </div>

</div>

<script>
let companies = [];

// Load companies
window.onload = function() {
    fetch("http://localhost:8080/api/companies")
        .then(res => res.json())
        .then(data => {
            companies = data;
            populateDropdown(companies);
        })
        .catch(err => {
            document.getElementById("companyDropdown").innerHTML =
                "<option>Error loading companies</option>";
        });
};

// Populate dropdown
function populateDropdown(list) {
    const dropdown = document.getElementById("companyDropdown");
    dropdown.innerHTML = "";

    list.forEach(c => {
        const option = document.createElement("option");
        option.value = c.symbol;
        option.text = c.companyName + " (" + c.symbol + ")";
        dropdown.appendChild(option);
    });
}

// Search filter
document.getElementById("searchBox").addEventListener("input", function() {
    const keyword = this.value.toLowerCase();

    const filtered = companies.filter(c =>
        c.companyName.toLowerCase().includes(keyword) ||
        c.symbol.toLowerCase().includes(keyword)
    );

    populateDropdown(filtered);
});

// Analyze sentiment
function analyze() {
    const symbol = document.getElementById("companyDropdown").value;

    if (!symbol) {
        alert("Please select a company");
        return;
    }

    const resultDiv = document.getElementById("result");
    resultDiv.innerHTML = "<div class='loader'></div><p style='text-align:center'>Scraping news & analyzing...</p>";

    fetch(`http://localhost:8080/api/sentiment?symbol=${symbol}`)
        .then(res => res.text())
        .then(data => {
            resultDiv.innerHTML = `
                <h3>Result for ${symbol}</h3>
                <pre style="white-space: pre-wrap;">${data}</pre>
            `;
        })
        .catch(err => {
            resultDiv.innerHTML = "Error during analysis";
        });
}
</script>

</body>
</html>